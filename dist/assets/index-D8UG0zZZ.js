(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();let n,w,b,C;function T(){Promise.all([import("https://cdn.jsdelivr.net/npm/three/build/three.module.js"),import("https://cdn.jsdelivr.net/npm/three/examples/jsm/controls/OrbitControls.js"),import("https://cdn.jsdelivr.net/npm/three/examples/jsm/geometries/ParametricGeometry.js"),import("https://cdn.jsdelivr.net/npm/three/examples/jsm/libs/stats.module.js")]).then(([s,o,r,a])=>{n=s,w=o.OrbitControls,b=r.ParametricGeometry,C=a.default,console.log("THREE.js loaded",n),console.log("OrbitControls loaded",w),console.log("ParametricGeometry loaded",b),console.log("Stats module loaded",C),new j}).catch(s=>{console.error("Error loading modules:",s)})}T();const E=.03,v=1-E,P=.1,S=18/1e3,L=S*S,c=30,h=30,p=10,d=-100,O=300,x=300,M=.8,I=.1,V=3,A=.75,g=20,G=1e3,H=500,N=1;class D{constructor(i,e,t,s){this.position=new n.Vector3,this.previous=new n.Vector3,this.original=new n.Vector3,this.a=new n.Vector3(0,0,0),this.mass=s,this.invMass=1/s,this.tmp=new n.Vector3,this.tmp2=new n.Vector3,this.position.set(i,e,t),this.previous.copy(this.position),this.original.copy(this.position)}addForce(i){this.a.add(this.tmp2.copy(i).multiplyScalar(this.invMass))}integrate(i){const e=this.tmp.subVectors(this.position,this.previous);e.multiplyScalar(v).add(this.position),e.add(this.a.multiplyScalar(i)),this.tmp=this.previous,this.previous=this.position,this.position=e,this.a.set(0,0,0)}}class j{constructor(){this.scene=new n.Scene,this.setupCamera(),this.setupLights(),this.setupRenderer(),this.setupCloth(),this.setupTable(),this.setupControls(),this.startTime=Date.now(),this.isPinned=!0,this.animate=this.animate.bind(this),requestAnimationFrame(this.animate)}setupCamera(){this.camera=new n.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.set(0,500,1e3),this.camera.lookAt(0,0,0)}setupLights(){const i=new n.AmbientLight(6710886);this.scene.add(i);const e=new n.DirectionalLight(16777215,1);e.position.set(50,200,100),e.castShadow=!0,this.scene.add(e)}setupRenderer(){this.renderer=new n.WebGLRenderer({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,document.body.appendChild(this.renderer.domElement)}setupCloth(){const t=300/c,s=200/h;this.particles=[];for(let a=0;a<=h;a++)for(let l=0;l<=c;l++){const m=(l-c/2)*t,f=200,y=(a-h/2)*s;this.particles.push(new D(m,f,y,P))}this.constraints=[],this.createConstraints();const o=new b((a,l,m)=>{const f=a*300-150,y=l*200;m.set(f,y,0)},c,h),r=new n.MeshPhongMaterial({color:4473924,side:n.DoubleSide,wireframe:!1});this.clothMesh=new n.Mesh(o,r),this.clothMesh.castShadow=!0,this.clothMesh.receiveShadow=!0,this.scene.add(this.clothMesh)}setupTable(){const i=new n.BoxGeometry(O,20,x),e=new n.MeshPhongMaterial({color:8939059});this.table=new n.Mesh(i,e),this.table.position.y=d,this.table.receiveShadow=!0,this.scene.add(this.table)}setupControls(){this.controls=new w(this.camera,this.renderer.domElement),this.stats=new C,document.body.appendChild(this.stats.dom)}createConstraints(){for(let e=0;e<h;e++)for(let t=0;t<c;t++){const s=this.particles[e*(c+1)+t],o=this.particles[e*(c+1)+(t+1)],r=this.particles[(e+1)*(c+1)+t];this.constraints.push([s,o,p]),this.constraints.push([s,r,p])}const i=Math.sqrt(p*p*2);for(let e=0;e<h;e++)for(let t=0;t<c;t++){const s=this.particles[e*(c+1)+t],o=this.particles[(e+1)*(c+1)+(t+1)],r=this.particles[e*(c+1)+(t+1)],a=this.particles[(e+1)*(c+1)+t];this.constraints.push([s,o,i]),this.constraints.push([r,a,i])}}simulate(){this.isPinned&&Date.now()-this.startTime>G&&(this.isPinned=!1);const i=new n.Vector3(0,-1373.3999999999999,0).multiplyScalar(P);for(const e of this.particles)e.addForce(i),e.integrate(L);if(this.isPinned){const e=Math.floor(this.particles.length/2),t=this.particles[e];t.position.set(0,H,0),t.previous.copy(t.position)}for(let e=0;e<V;e++){for(const[t,s,o]of this.constraints)this.satisfyConstraint(t,s,o);this.handleCollisions()}}handleCollisions(){const i=d+g/2,e=this.calculateCenterOfMass();for(const t of this.particles)if(t.position.y<i){const s=i-t.position.y,o=new n.Vector3().subVectors(t.position,t.previous);if(new n.Vector3().subVectors(t.position,e),t.position.y=i,o.length()<I)t.previous.copy(t.position);else{const r=new n.Vector3(o.x,0,o.z);r.multiplyScalar(N),t.previous.x=t.position.x-r.x*(1-M),t.previous.z=t.position.z-r.z*(1-M),t.previous.y=t.position.y-o.y*A}this.propagateCollision(t,s*.5)}}calculateCenterOfMass(){const i=new n.Vector3;for(const e of this.particles)i.add(e.position);return i.divideScalar(this.particles.length)}propagateCollision(i,e){for(const[t,s]of this.constraints)t===i&&s.position.y<d+g?s.position.y+=e:s===i&&t.position.y<d+g&&(t.position.y+=e)}satisfyConstraint(i,e,t){const s=new n.Vector3().subVectors(e.position,i.position),o=s.length();if(o===0)return;const a=s.multiplyScalar(1-t/o).multiplyScalar(.5);i.position.add(a),e.position.sub(a)}updateClothGeometry(){const i=this.clothMesh.geometry.attributes.position;for(let e=0;e<this.particles.length;e++){const t=this.particles[e];i.setXYZ(e,t.position.x,t.position.y,t.position.z)}i.needsUpdate=!0,this.clothMesh.geometry.computeVertexNormals()}animate(){requestAnimationFrame(this.animate),this.simulate(),this.updateClothGeometry(),this.renderer.render(this.scene,this.camera),this.stats.update()}}
